{% extends "base.html" %}
{% block content %}

<h1 class="mb-3">{{ title }}</h1>

{# --- 1. Top 5 Growth Section (MODIFIED) --- #}
{% if top_growth_stocks %}
<h3 class="mt-4">Top 5 Growth Stocks (Past Year)</h3>
<div class="row row-cols-1 row-cols-md-3 row-cols-lg-5 g-4 mb-4">

    {# --- MODIFICATION: Unpack price --- #}
    {% for ticker, growth, price in top_growth_stocks %}
    <div class="col">
        <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column"> {# Use flex-column for better alignment #}
                <h5 class="card-title">{{ ticker }}</h5>
                <p class="card-text mb-1">
                    Growth:
                    <span class="fw-bold {% if growth > 0 %}text-success{% elif growth < 0 %}text-danger{% else %}text-secondary{% endif %}">
                  {{ "%.2f"|format(growth) }}%
                </span>
                </p>

                {# --- NEW: Display Current Price --- #}
                <p class="card-text mb-1">
                    Price:
                    <span class="fw-bold text-dark">
                  {% if price is not none %}
                    ${{ "%.2f"|format(price) }}
                  {% else %}
                    N/A
                  {% endif %}
                </span>
                </p>

                {# Founding Year (moved to bottom) #}
                {% set year = founding_years.get(ticker, 'N/A') %}
                <p class="card-text mt-auto"><small class="text-muted">Founded: {{ year }}</small></p> {# mt-auto pushes
                to bottom #}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% elif tickers %}
<div class="alert alert-warning mt-4">Could not calculate top growth stocks (check price data and logs).</div>
{% endif %}
{# --- END: Top 5 Growth Section --- #}

{# --- 2. Full S&P 500 List with Founding Years (MODIFIED) --- #}
{% if tickers %}
<h3 class="mt-4">Full S&P 500 List</h3>
<p>Found data for {{ tickers | length }} companies.</p>
<div class="table-responsive" style="max-height: 500px; overflow-y: auto;"> {# Increased height #}
    <table class="table table-striped table-sm table-hover">
        <thead class="sticky-top bg-light">
        <tr>
            <th>Ticker</th>
            {# --- NEW: Table Headers --- #}
            <th>1-Year Growth</th>
            <th>Current Price</th>
            <th>Founding Year</th>
        </tr>
        </thead>
        <tbody>
        {% for ticker in tickers %}
        {# --- NEW: Get growth and price data for this ticker --- #}
        {% set growth = growth_data.get(ticker, 0.0) %}
        {% set price = current_prices.get(ticker) %}
        <tr>
            <td>{{ ticker }}</td>

            {# --- NEW: Growth Column --- #}
            <td>
                <span class="{% if growth > 0 %}text-success{% elif growth < 0 %}text-danger{% else %}text-secondary{% endif %}">
                  {{ "%.2f"|format(growth) }}%
                </span>
            </td>

            {# --- NEW: Price Column --- #}
            <td>
                {% if price is not none and price > 0 %}
                ${{ "%.2f"|format(price) }}
                {% else %}
                N/A
                {% endif %}
            </td>
            <td>{{ founding_years.get(ticker, 'N/A') }}</td>

        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-danger">Could not load S&P 500 data. Check server logs.</div>
{% endif %}

{% endblock %}